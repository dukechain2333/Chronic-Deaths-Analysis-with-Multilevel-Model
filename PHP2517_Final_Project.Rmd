---
title: "PHP2517 Final Project"
author: "Peirong Hao, William Qian"
output:
  pdf_document: default
header-includes: \usepackage{fvextra} \DefineVerbatimEnvironment{Highlighting}{Verbatim}{breaklines,commandchars=\\\{\}}
---

```{r setup, include=FALSE}
# https://yihui.org/knitr/options/
knitr::opts_chunk$set(message=FALSE, 
                      warning=FALSE, 
                      error=FALSE, 
                      echo = FALSE, 
                      fig.pos = "H" ,
                      fig.align = 'center',
                      tidy=TRUE, tidy.opts=list(width.cutoff=80))

library(tidyverse)
library(knitr)
set.seed(123)
library(tidyr)       ## Used to tidy data
library(dplyr)       ## Used to manipulate data
```

```{r}
library(readxl)
df.chronic <-read_excel('hosp_eolchronic_dead6699ffs_2019.xlsx')

#first convert columns to factor or numeric columns

#relevel: first level is state, second level is region
#https://www.bu.edu/brand/guidelines/editorial-style/us-state-abbreviations/
#https://www2.census.gov/geo/pdfs/maps-data/maps/reference/us_regdiv.pdf
#Note: 1 state is US(unsure), so remove that obervation

df.chronic <- df.chronic %>% mutate_if(is.character,as.factor) %>% 
  mutate(across(.cols = c(
  `SNF/Long-Term Care Sector Reimbursements per Decedent during the Last Two Years of Life`,
  `Hospice Sector Reimbursements per Decedent during the Last Two Years of Life`,
  `Total ICU Bed Inputs per 1,000 Decedents during the Last Two Years of Life`,
  `High-Intensity ICU Bed Inputs per 1,000 Decedents during the Last Two Years of Life`,
  `Intermediate-Intensity ICU Bed Inputs per 1,000 Decedents during the Last Two Years of Life`,
  `Medical & Surgical Unit Bed Inputs per 1,000 Decedents during the Last Two Years of Life`,
  `SNF Bed Inputs per 1,000 Dededents during the Last Two Years of Life`,,
  `RNs Required Under Proposed Federal Standards per 1,000 Decedents during the Last Two Years of Life`,
  `High-Intensity ICU Days per Decedent during the Last Six Months of Life`,
  `Intermediate-Intensity ICU Days per Decedent during the Last Six Months of Life`,
  `Medical & Surgical Unit Days per Decedent during the Last Six Months of Life`,
  `Percent of Decedents Enrolled In Hospice during the Last Six Months of Life`,
  `Hospice Days per Decedent during the Last Six Months of Life`),~as.numeric(.)))%>%
  mutate(Region = case_when(State %in% c("CT","ME","MA","NH","RI","VT","NJ","NY","PA") ~ "Northeast",
                            State %in% c("IN","IL","MI","OH","WI","IA","KS","MN","MO","NE","ND","SD") ~ "Midwest",
                            State %in% c("DE","DC","FL","GA","MD","NC","SC","VA","WV","AL","KY","MS","TN","AR","LA","OK","TX") ~ "South",
                            State %in% c("AZ","CO","ID","NM","MT","UT","NV","WY","AK","CA","HI","OR","WA") ~ "West"),
         Region = factor(Region))%>% 
  filter(!is.na(Region))

#summary(df.chronic)
# summary(df.chronic$State)
# summary(df.chronic$Region)

#proposal: association between variables and outcome, clear y, x 
#model selection: aic, model assumption 
```

```{r}
# library(DataExplorer)
# library(magrittr)
# #eda<-eda %>% select(shape,price,carat,cut,color,clarity,report,type)
# plot_histogram(df.chronic)
# plot_bar(df.chronic) 
```

```{r,out.width="50%"}
# df_numeric <- df.chronic %>%  select_if(is.numeric)
# cor.numeric <- cor(df_numeric, use = "complete.obs")
# cor.numeric
```

```{r}
library(dplyr)
library(kableExtra)
#create table summarizing antiscore
overall_summary <- df.chronic %>%
  group_by(Region, State) %>% 
  summarise(
  n = (length(`Number of deaths among chronically ill patients assigned to hospital`)-sum(is.na(`Number of deaths among chronically ill patients assigned to hospital`))),
  mean = round(mean(`Number of deaths among chronically ill patients assigned to hospital`, na.rm = T), 3),
  sd = round(sd(`Number of deaths among chronically ill patients assigned to hospital`, na.rm = T), 3),
  median = round(median(`Number of deaths among chronically ill patients assigned to hospital`, na.rm = T), 3),
  min = round(min(`Number of deaths among chronically ill patients assigned to hospital`, na.rm = T), 3),
  max = round(max(`Number of deaths among chronically ill patients assigned to hospital`, na.rm = T), 3))%>%
  ungroup()

#output table for overall averages
overall_summary %>%
  mutate_all(linebreak) %>%
  kbl(caption = "Summary of Number of deaths",
  col.names=linebreak(c("Region", "State", "N", "Mean", "SD", "Median", "Min", "Max")),
  booktabs=T, escape=F, align = "c") %>%
kable_styling(full_width = FALSE, latex_options = c('hold_position'))
```



